{{!--
  @generated by @igniter-js/new-cli
  @description CRUD controller generated from the {{modelName}} Prisma model
--}}
import { igniter } from '@/igniter'
import { z } from 'zod'
import { {{procedureName}} } from '../procedures/{{featureName}}.procedure'
import { Create{{modelName}}InputSchema, Update{{modelName}}InputSchema } from '../{{featureName}}.interfaces'

export const {{controllerVariable}} = igniter.controller({
  name: '{{modelName}}',
  description: 'REST endpoints for {{modelNamePlural}}',
  path: '/{{resourcePath}}',
  actions: {
    list: igniter.query({
      name: 'list',
      description: 'List all {{modelNamePlural}}',
      path: '/',
      use: [{{procedureName}}()],
      handler: async ({ context, response }) => {
        const records = await context.{{repositoryName}}.findAll()
        return response.success(records)
      },
    }),
    getById: igniter.query({
      name: 'getById',
      description: 'Get a {{modelName}} by id',
      path: '/:id' as const,
      params: z.object({
        id: {{idZodType}},
      }),
      use: [{{procedureName}}()],
      handler: async ({ request, context, response }) => {
        const record = await context.{{repositoryName}}.findById(request.params.id)
        if (!record) {
          return response.notFound('{{modelName}} not found')
        }
        return response.success(record)
      },
    }),
    create: igniter.mutation({
      name: 'create',
      description: 'Create a new {{modelName}}',
      path: '/',
      method: 'POST',
      body: Create{{modelName}}InputSchema,
      use: [{{procedureName}}()],
      handler: async ({ request, context, response }) => {
        const created = await context.{{repositoryName}}.create(request.body)
        return response.created(created)
      },
    }),
    update: igniter.mutation({
      name: 'update',
      description: 'Update a {{modelName}}',
      path: '/:id' as const,
      method: 'PUT',
      params: z.object({
        id: {{idZodType}},
      }),
      body: Update{{modelName}}InputSchema,
      use: [{{procedureName}}()],
      handler: async ({ request, context, response }) => {
        const updated = await context.{{repositoryName}}.update(request.params.id, request.body)
        return response.success(updated)
      },
    }),
    delete: igniter.mutation({
      name: 'delete',
      description: 'Delete a {{modelName}}',
      path: '/:id' as const,
      method: 'DELETE',
      params: z.object({
        id: {{idZodType}},
      }),
      use: [{{procedureName}}()],
      handler: async ({ request, context, response }) => {
        await context.{{repositoryName}}.delete(request.params.id)
        return response.noContent()
      },
    }),
  },
})
