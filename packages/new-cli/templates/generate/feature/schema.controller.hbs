{{!--
  @generated by @igniter-js/new-cli
  @description CRUD controller generated from the {{modelName}} Prisma model
--}}
import { igniter } from '@/igniter'
import { z } from 'zod'
import { {{procedureExport}} } from '../procedures/{{featureName}}.procedure'
import { Create{{modelName}}InputSchema, Update{{modelName}}InputSchema } from '../{{featureName}}.interfaces'

export const {{controllerExport}} = igniter.controller({
  name: '{{controllerDisplayName}}',
  description: 'REST endpoints for {{modelNamePlural}}',
  path: '/{{resourcePath}}',
  actions: {
    list: igniter.query({
      name: 'List',
      description: 'List {{modelNamePlural}}',
      path: '/',
      use: [{{procedureExport}}()],
      handler: async ({ context, response }) => {
        const records = await context.{{procedureExport}}.services.findAll()
        return response.success(records)
      },
    }),
    getById: igniter.query({
      name: 'Get By Id',
      description: 'Get {{modelName}} by id',
      path: '/:id' as const,
      params: z.object({
        id: {{idZodType}},
      }),
      use: [{{procedureExport}}()],
      handler: async ({ request, context, response }) => {
        const record = await context.{{procedureExport}}.services.findById(request.params.id)
        if (!record) {
          return response.notFound('{{modelName}} not found')
        }
        return response.success(record)
      },
    }),
    create: igniter.mutation({
      name: 'Create',
      description: 'Create {{modelName}}',
      path: '/',
      method: 'POST',
      body: Create{{modelName}}InputSchema,
      use: [{{procedureExport}}()],
      handler: async ({ request, context, response }) => {
        const created = await context.{{procedureExport}}.services.create(request.body)
        return response.created(created)
      },
    }),
    update: igniter.mutation({
      name: 'Update',
      description: 'Update {{modelName}}',
      path: '/:id' as const,
      method: 'PUT',
      params: z.object({
        id: {{idZodType}},
      }),
      body: Update{{modelName}}InputSchema,
      use: [{{procedureExport}}()],
      handler: async ({ request, context, response }) => {
        const updated = await context.{{procedureExport}}.services.update(request.params.id, request.body)
        return response.success(updated)
      },
    }),
    delete: igniter.mutation({
      name: 'Delete',
      description: 'Delete {{modelName}}',
      path: '/:id' as const,
      method: 'DELETE',
      params: z.object({
        id: {{idZodType}},
      }),
      use: [{{procedureExport}}()],
      handler: async ({ request, context, response }) => {
        await context.{{procedureExport}}.services.delete(request.params.id)
        return response.noContent()
      },
    }),
  },
})
